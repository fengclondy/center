<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.htd.promotion.cpc.biz.dao.PromotionBargainInfoDAO" >
  <resultMap id="BaseResultMap" type="cn.htd.promotion.cpc.biz.dmo.PromotionBargainInfoDMO" >
   <id column="BARGAIN_ID" property="bargainId" jdbcType="BIGINT" />
    <result column="PROMOTION_ID" property="promotionId" jdbcType="VARCHAR" />
    <result column="LEVEL_CODE" property="levelCode" jdbcType="VARCHAR" />
    <result column="GOODS_PICTURE" property="goodsPicture" jdbcType="VARCHAR" />
    <result column="GOODS_NAME" property="goodsName" jdbcType="VARCHAR" />
    <result column="GOODS_COST_PRICE" property="goodsCostPrice" jdbcType="DECIMAL" />
    <result column="GOODS_FLOOR_PRICE" property="goodsFloorPrice" jdbcType="DECIMAL" />
    <result column="PARTAKE_TIMESE" property="partakeTimes" jdbcType="TINYINT" />
    <result column="GOODS_NUM" property="goodsNum" jdbcType="TINYINT" />
    <result column="CREATE_ID" property="createId" jdbcType="BIGINT" />
	<result column="CREATE_NAME" property="createName" jdbcType="VARCHAR" />
	<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
	<result column="MODIFY_ID" property="modifyId" jdbcType="BIGINT" />
	<result column="MODIFY_NAME" property="modifyName" jdbcType="VARCHAR" />
	<result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
  </resultMap>
  
     <select id="getPromotionBargainInfoDetail" resultMap="BaseResultMap" parameterType="cn.htd.promotion.cpc.dto.request.BuyerBargainLaunchReqDTO" >
     <![CDATA[
	    select pbi.bargain_id bargainId ,
	    	   pbi.promotion_id promotionId,
	    	   pbi.level_code levelCode,
	    	   pbi.goods_picture goodsPicture,
	    	   pbi.goods_name goodsName,
	    	   pbi.goods_cost_price goodsCostPrice,
	    	   pbi.goods_floor_price goodsFloorPrice,
	    	   pbi.partake_times partakeTimes,pbi.goods_num goodsNum,
	    	   ps.promotion_slogan promotionDescribe,
	    	   psd.seller_name sellerName,
	    	   pei.contact_name contactName,
	    	   pei.contact_telephone contactTelphone,
	    	   pei.contact_address contactAddress,
	    	   pei.each_start_time eachStartTime,
	    	   pei.each_end_time eachEndTime,
	    	   pei.offline_start_time offlineStartTime,
	    	   pei.offline_end_time offlineEndTime,
	    	   plb.launch_time launchTime,
	    	   plb.bargain_over_time bargainOverTime,
	    	   plb.is_bargain_over isBargainOver,
	    	   plb.goods_current_price goodsCurrentPrice
	    from promotion_bargain_info pbi
	    left join promotion_slogan ps on pbi.promotion_id = ps.promotion_id
	    left join promotion_seller_detail psd on pbi.promotion_id = psd.promotion_id
	    left join promotion_extend_info pei on pbi.promotion_id = pei.promotion_id
	    left join buyer_launch_bargain_info plb on (plb.promotion_id = pbi.promotion_id and plb.level_code = pbi.level_code)
	     where
	    pbi.promotion_id = #{promotionId,jdbcType=VARCHAR} 
	    and pbi.level_code = #{levelCode,jdbcType=VARCHAR}
	    <if test="buyerCode != null">
			and plb.buyer_code = #{buyerCode,jdbcType=VARCHAR}
		</if>
	    ]]>
    </select>
</mapper>